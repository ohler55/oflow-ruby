<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>
  <head>
    <title>Pete Ohler's Gem History</title>
    <link rel="icon" href="images/o.ico">
    <link rel="stylesheet" href="gemchart.css"/>
  </head>

  <body>
    <p class="title">
      Pete Ohler's Gem History
    </p>
    <p>something goes here
    </p>
    <table >
      <tr>
	<td>
	  <canvas id="graph" width="1000" height="500"></canvas>
	</td>
      </tr>
    </table>
    <script>
      var canvas = document.getElementById('graph');
      var context = canvas.getContext('2d');
      var w = canvas.width;
      var h = canvas.height;
      var r = 8;
      var pad = 30;
      var gw = w - pad - r;
      var gh = h - pad - r;

      function graphIt(ptSets) {
        context.strokeStyle = '#0000ff';
        var y = 20;
        for (var key in ptSets){
          var pts=ptSets[key];
          var j0=pts[0][0];
          var je=pts[pts.length-1][0];
          var dj = je-j0;
          var dmx=pts[pts.length-1][1]*1.0;

          context.beginPath();
          context.moveTo(pad, h-pad);
          for (var i in pts){
            var pt=pts[i];
            context.lineTo(pad+((pt[0]-j0)*gw/dj), h-pad-(pt[1]*gh/dmx));
          }
          context.stroke();
        }
      }

      context.lineWidth = 1;
      context.beginPath();
      context.strokeStyle = '#000080';
      context.moveTo(r+1, 1);
      context.lineTo(w-r, 1);
      context.quadraticCurveTo(w-1, 1, w-1, r);
      context.lineTo(w-1, h-r);
      context.quadraticCurveTo(w-1, h-1, w-r, h-1);
      context.lineTo(r, h-2);
      context.quadraticCurveTo(1, h-1, 1, h-r);
      context.lineTo(0, r);
      context.quadraticCurveTo(1, 1, r, 1);
      context.stroke();
      context.fillStyle = 'white';
      context.fill();

      context.beginPath();
      context.strokeStyle = '#c08000';
      context.moveTo(pad, r);
      context.lineTo(pad, h-pad+4);
      context.moveTo(pad-4, h-pad);
      context.lineTo(w-r, h-pad);
      context.stroke();

      var request = new XMLHttpRequest();
      request.open('GET', 'oj.json', true);
      request.onreadystatechange = function() {
        if(4 == request.readyState && 200 == request.status) {
          graphIt(JSON.parse(request.responseText));
        }
      };
      request.send(null);
    </script>
  </body>
</html>
